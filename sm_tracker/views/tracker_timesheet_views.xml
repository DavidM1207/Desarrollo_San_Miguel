<?xml version="1.0" encoding="utf-8"?>
<odoo>
    
    <!-- Vista Tree de Registros de Tiempo -->
    <record id="view_tracker_timesheet_tree" model="ir.ui.view">
        <field name="name">tracker.timesheet.tree</field>
        <field name="model">tracker.timesheet</field>
        <field name="arch" type="xml">
            <tree string="Registros de Tiempo" 
                  decoration-success="state=='stopped'" 
                  decoration-warning="state=='running'"
                  create="0" 
                  delete="0" 
                  edit="0">
                <field name="task_id"/>
                <field name="project_id"/>
                <field name="operator_id" widget="many2one_avatar_user"/>
                <field name="start_time"/>
                <field name="end_time"/>
                <field name="duration" widget="float_time" sum="Total"/>
                <field name="user_id" widget="many2one_avatar_user"/>
                <field name="state" widget="badge"
                       decoration-success="state=='stopped'" 
                       decoration-warning="state=='running'"/>
            </tree>
        </field>
    </record>
    
    <!-- Vista Form de Registros de Tiempo -->
    <record id="view_tracker_timesheet_form" model="ir.ui.view">
        <field name="name">tracker.timesheet.form</field>
        <field name="model">tracker.timesheet</field>
        <field name="arch" type="xml">
            <form string="Registro de Tiempo" create="0" delete="0" edit="0">
                <sheet>
                    <group>
                        <group>
                            <field name="task_id" readonly="1"/>
                            <field name="project_id" readonly="1"/>
                            <field name="operator_id" readonly="1"/>
                        </group>
                        <group>
                            <field name="start_time" readonly="1"/>
                            <field name="end_time" readonly="1"/>
                            <field name="duration" widget="float_time" readonly="1"/>
                            <field name="state" readonly="1"/>
                        </group>
                    </group>
                    <group>
                        <group>
                            <field name="user_id" readonly="1"/>
                        </group>
                    </group>
                    <group string="Notas">
                        <field name="notes" readonly="1" nolabel="1"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>
    
    <!-- Vista Search de Registros de Tiempo -->
    <record id="view_tracker_timesheet_search" model="ir.ui.view">
        <field name="name">tracker.timesheet.search</field>
        <field name="model">tracker.timesheet</field>
        <field name="arch" type="xml">
            <search string="Buscar Registros">
                <field name="task_id"/>
                <field name="project_id"/>
                <field name="operator_id"/>
                <filter string="En Ejecución" name="running" domain="[('state', '=', 'running')]"/>
                <filter string="Detenido" name="stopped" domain="[('state', '=', 'stopped')]"/>
                <separator/>
                <filter string="Mis Registros" name="my_records" domain="[('operator_id', '=', uid)]"/>
                <filter string="Hoy" name="today" 
                        domain="[('start_time', '&gt;=', context_today().strftime('%Y-%m-%d 00:00:00')),
                                 ('start_time', '&lt;=', context_today().strftime('%Y-%m-%d 23:59:59'))]"/>
                <filter string="Esta Semana" name="this_week" 
                        domain="[('start_time', '&gt;=', (context_today() - relativedelta(weeks=1)).strftime('%Y-%m-%d')),
                                 ('start_time', '&lt;=', context_today().strftime('%Y-%m-%d'))]"/>
                <group expand="0" string="Agrupar Por">
                    <filter string="Tarea" name="group_task" context="{'group_by': 'task_id'}"/>
                    <filter string="Proyecto" name="group_project" context="{'group_by': 'project_id'}"/>
                    <filter string="Operario" name="group_operator" context="{'group_by': 'operator_id'}"/>
                    <filter string="Estado" name="group_state" context="{'group_by': 'state'}"/>
                    <filter string="Fecha de Inicio" name="group_start_date" context="{'group_by': 'start_time:day'}"/>
                </group>
            </search>
        </field>
    </record>
    
    <!-- Vista Pivot de Registros de Tiempo -->
    <record id="view_tracker_timesheet_pivot" model="ir.ui.view">
        <field name="name">tracker.timesheet.pivot</field>
        <field name="model">tracker.timesheet</field>
        <field name="arch" type="xml">
            <pivot string="Análisis de Tiempo">
                <field name="operator_id" type="row"/>
                <field name="task_id" type="row"/>
                <field name="duration" type="measure"/>
            </pivot>
        </field>
    </record>
    
    <!-- Vista Graph de Registros de Tiempo -->
    <record id="view_tracker_timesheet_graph" model="ir.ui.view">
        <field name="name">tracker.timesheet.graph</field>
        <field name="model">tracker.timesheet</field>
        <field name="arch" type="xml">
            <graph string="Gráfico de Tiempo" type="bar">
                <field name="operator_id"/>
                <field name="duration" type="measure"/>
            </graph>
        </field>
    </record>
    
    <!-- Acción de ventana para Registros de Tiempo -->
    <record id="action_tracker_timesheet" model="ir.actions.act_window">
        <field name="name">Registros de Tiempo</field>
        <field name="res_model">tracker.timesheet</field>
        <field name="view_mode">tree,pivot,graph,form</field>
        <field name="context">{}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No hay registros de tiempo todavía
            </p>
            <p>
                Los registros de tiempo se generan automáticamente al iniciar tareas.
            </p>
        </field>
    </record>
    
    <!-- Acción para ver mis registros de tiempo -->
    <record id="action_my_tracker_timesheet" model="ir.actions.act_window">
        <field name="name">Mis Registros de Tiempo</field>
        <field name="res_model">tracker.timesheet</field>
        <field name="view_mode">tree,pivot,graph,form</field>
        <field name="domain">[('operator_id', '=', uid)]</field>
        <field name="context">{'search_default_this_week': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No tienes registros de tiempo
            </p>
        </field>
    </record>

</odoo>